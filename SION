#include<stdio.h>
#include <stdlib.h>  
#include<time.h>                                            // 랜덤함수 헤더파일
#define Exp_boxrand (((float)(rand() % 7)  / 10) + 1.8)          // 2레벨 이후 부터 1레벨 당 경험치 수치는 1.8배 ~ 2.5배 랜덤으로 선택된다.
#define Exp_rand rand() % 7001 - 3500                           // 경험치 -3500 ~ +3500 랜덤으로 선택된다.
#define Boss_rand (((float)(rand() % 40) / 10) + 1)              // Boss 경험치는 1.0배 ~ 5.0 랜덤으로 선택된다.
int main()
{
    // 변수 설정
    char name[20];
    float event_Exp = 0;                        // 각 던전마다 발생한 경험치
    float Exp = 0;                              // 경험치 창
    float Exp_box = 30000;                      // 레벨업에 필요한 경험치량 (1레벨일떄 3만 고정)
    float Prev_Exp_box = 30000;                 // 이전레벨 경험치량 보관 변수
    int level = 1;
    int turn = 0;                               // 턴 수 체크
    int user;                                   // 게임진행 방법 정하는 변수
    int stage = 0;                              // 1~5단계 스테이지
    int event = 0;                              // 단계 내 이벤트
    int monster_number = 0;                     // 몬스터를 랜덤으로 뽑기 위한 대입 연산자
    int monster_WN = 0;                         // 몬스터 약점을 랜덤으로 뽑기 위한 대입 연산자


    srand(time(NULL));                          // 랜덤 변수 시간을 이용해 계속 초기화
    
    printf("여기는 불면의 저주에 걸린 개발원입니다.\n");
    printf("당신의 이름을 입력하세요.\n");
    scanf("%s", name);
    printf("%s님 안녕하세요! 당신은 불면의 저주에 걸렸습니다! 해주를 할려면 개발원을 정복하세요!\n", name);
    printf("Tip : 아메리카노를 수혈하세요!\n섭취시 도핑효과로 잠시동안 불면의 저주를 약화시킬수 있습니다\n");

    while(1)                                    // 나중에 ture로 무한반복해서 99렙이나 1렙 이하일때 브레이크로 나오자
    {
        if(level == 1)
        {
            Exp_box = 30000;                    // 레벨이 1이 되면 경험치필요량 3만 고정
        }

        for(stage = 1; stage <= 5; stage++)              // 스테이지 1단계부터 5단계까지
        {
            // printf("%d턴\n", stage); 밑에 턴 수 표시 있음  ★★★★
            for(event = 0; event < 5; event++)                // 단계 내 이벤트 
            {          
                event_Exp = Exp_rand;                         // -3500 ~ +3500까지 랜덤하게 뽑아준다
                Exp += event_Exp;                             // 발생한 경험치 누적

                char monster_information[70];
                monster_number = (rand() % 4) +1;
                if(monster_number == 1)
                {
                    char monster_information[70] = "Captain Ddong";
                }
                else if(monster_number == 2)
                {
                    char monster_information[70] = "Scarlet Onsi";
                }
                else if(monster_number == 3)
                {
                    char monster_information[70] = "Iron Boy";
                }
                else
                {
                    char monster_information[70] = "Juno Panther";
                }
                printf("%d던전) %s가 나타났습니다.\n", event+1, monster_information);

                char monster_week[20];
                monster_WN = (rand() % 4) +1;
                if(monster_WN == 1)
                {
                    char monster_week[20] = "오른손";
                }
                else if(monster_WN == 2)
                {
                    char monster_week[20] = "왼손";
                }
                else if(monster_WN == 3)
                {
                    char monster_week[20] = "오른발";
                }
                else
                {
                    char monster_week[20] = "왼발";
                }
                printf("       (Tip: %s이 약점입니다.)\n", monster_week);

                    if (event_Exp >= 0)
                    {
                        printf("       %s를 처치하였습니다.\n", monster_information);
                        printf("       💖   %.2f의 경험치를 획득했습니다.\n\n", event_Exp);
                    }
                    else
                    {
                        printf("       %s를 처치하지 못 했습니다.\n", monster_information);
                        printf("       💔   %.2f의 경험치가 차감되었습니다.\n\n", event_Exp*(-1));
                    }
                if(event == 4) // 단계 내 이벤트 (6번째-보스)
                {
                    printf("보스 몬스터 ⚡⚡⚡   민건 스트레인지    ⚡⚡⚡가 등장 했습니다.\n");
                    Exp = Exp * Boss_rand;                  // 기존 exp에 보스 추가경험치곱 1.0~5.0랜덤한 값 곱
                }
            }

            while(Exp > Exp_box)                             // 레벨업!
            {
                printf("축하합니다 레벨업 하셨습니다!\n");
                printf("#$%%^^*지금당장 성장 패키지 구매!\n");
                level++;
                Prev_Exp_box = Exp_box;                 // 이전레벨 경험치 필요량 저장
                Exp = Exp - Exp_box;                    // 초과 경험치 이월
                Exp_box = Exp_box * Exp_boxrand;
                printf("레벨 업!\n현재 %d레벨입니다.\n", level); 
                printf("%d레벨에 필요한 경험치는 %.f입니다.\n", level+1 ,Exp_box);

                if(level == 99)                                  // 99렙이상이면 종료
                {
                    break;
                }
            }
            
            if (Exp < 0)                                       // 레벨 하락
            {
                printf("이런 레벨이 하락했습니다. 조심하십시요 보스는 강합니다.\n");
                printf("팁 : IRON 몬스터는 오른손이 약점입니다.\n");
                --level;
                Exp = 0;                                // 미달 경험치 차감?? 초기화인가요?
                Exp_box = Prev_Exp_box;                 // 이전 경험치 필요량으로 회귀
                printf("레벨 다운!\n현재 %d레벨입니다.\n", level);
            }

            // else if(Exp < Exp_box)
            // {
            //     Exp = Exp;
            //     Exp_box = Exp_box;
            //     printf("레벨 유지!\n현재 %d레벨입니다.\n", level);
            // }

            turn++;                                          // 턴 수 증가
            printf("\n");
            
            if(level == 99)                                  // 99렙이상이면 종료
            {
                break;
            }
            else if(level < 1)                  // 1렙이면서 경험치가 음수면 패배
            {
                break;
            }

            // printf("%d레벨입니다.\n", level);
            printf("현재 경험치는 %.2f 입니다.\n",Exp);
            printf("%d레벨입니다.\n", level);
            printf("지금까지 %d턴이 진행됬습니다.\n", turn);
            printf("진행중인 스테이지는 %d입니다.", stage);
            printf("다음 모험을 진행하려면 1을 입력\n클리어한 스테이지로 돌아간다면 2를 입력\n클리어한 스테이지의 이전 스테이지로 돌아가길 원한다면 3을 입력:\n");
            scanf("%d", &user);
            // user=getchar();
            
            if (user == 1)
            {
                printf("다음 모험을 진행합니다.\n");
                    continue;
            }
            else if(user == 2)
            {
                printf("해당 회차를 다시 도전합니다.\n");
                --stage;
                    continue;
            }
            else
            {
                printf("이전 회차를 도전합니다.\n");
                --stage;
                --stage;
                if(stage <=-1)              // stage가 음수로 되는 것을 막기 위한 장치
                {
                    stage = 0;
                }
                    continue;
            }
            printf("\n");

        }
        printf("\n");

        if(level == 99)                                  // 99렙이상이면 종료
        {
            printf("개발원 정복! 불면의 저주를 이겨냈습니다!\n이제 영원한 안식에 들 수 있습니다.\n");
            break;
        }
        else if(level < 1)                  // 1렙이면서 경험치가 음수면 패배
        {
            printf("YOU DIE\n불면의 저주에 잠식되어 \"과로사\"했습니다.");
            break;
        }

    }
    // printf("%d\n", Exp);
    printf("종료!");
    return 0;
}
